<!DOCTYPE html><html><head><title>Docspell: Convert Text Files</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Auto-tagging Document Organizer" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Docspell: Convert Text Files" /><meta name="title" property="og:title" content="Docspell: Convert Text Files" /><meta name="og:site_name" content="Docspell" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Auto-tagging Document Organizer" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Docspell: Convert Text Files" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="Auto-tagging Document Organizer" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/docspell.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Docspell</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/demo" title="Demo" class="">Demo</a></div> <div class="sidebar-nav-item  "><a href="/getit" title="Quickstart" class="">Quickstart</a></div> <div class="sidebar-nav-item  "><a href="/features" title="Features/Limitations" class="">Features/Limitations</a></div> <div class="sidebar-nav-item  "><a href="/doc" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/install" title="Installation" class="">Installation</a> <a href="/doc/configure" title="Configuring" class="">Configuring</a> <a href="/doc/nix" title="Nix/NixOS" class="">Nix/NixOS</a> <a href="/doc/reverseproxy" title="Reverse Proxy" class="">Reverse Proxy</a> <a href="/doc/metadata" title="Adding Meta Data" class="">Adding Meta Data</a> <a href="/doc/uploading" title="Uploads" class="">Uploads</a> <a href="/doc/processing" title="Processing Queue" class="">Processing Queue</a> <a href="/doc/curate" title="Find and Review" class="">Find and Review</a> <a href="/doc/mailitem" title="Send via E-Mail" class="">Send via E-Mail</a> <a href="/doc/notifydueitems" title="Notify on due Items" class="">Notify on due Items</a> <a href="/doc/joex" title="Joex" class="">Joex</a> <a href="/doc/tools" title="Tools" class="">Tools</a></div></div> <div class="sidebar-nav-item  "><a href="/dev" title="Development" class="drop-nested">Development</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/dev/adr" title="ADRs" class="">ADRs</a></div></div> <div class="sidebar-nav-item  "><a href="/api" title="Api" class="drop-nested">Api</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/openapi/docspell-openapi.html" title="REST Api Doc" class="">REST Api Doc</a> <a href="/openapi/docspell-openapi.yml" title="REST OpenApi Spec" class="">REST OpenApi Spec</a></div></div> <div class="sidebar-nav-item  "><a href="/changelog" title="Changelog" class="">Changelog</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="docspell"><div class="content-wrapper"><section><h1 id="convert-text-files">Convert Text Files</h1>

<h2 id="context-and-problem-statement">Context and Problem Statement</h2>

<p>How can plain text and markdown documents be converted into a PDF
files?</p>

<p>Rendering images is not important here, since the files must be self
contained when uploaded to Docspell.</p>

<p>The test file is the current documentation page of Docspell, found in
<code class="highlighter-rouge">microsite/docs/doc.md</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
layout: docs
position: 4
title: Documentation
---

# {page .title}


Docspell assists in organizing large amounts of PDF files that are
...

## How it works

Documents have two ...

1. You maintain a kind of address book. It should list all possible
   correspondents and the concerning people/things. This grows
   incrementally with each new unknown document.
2. When docspell analyzes a document, it tries to find matches within
   your address ...
3. You can inspect ...

The set of meta data that docspell uses to draw suggestions from, must
be maintained ...


## Terms

In order to better understand these pages, some terms should be
explained first.

### Item

An **Item** is roughly your (pdf) document, only that an item may span
multiple files, which are called **attachments**. And an item has
**meta data** associated:

- a **correspondent**: the other side of the communication. It can be
  an organization or a person.
- a **concerning person** or **equipment**: a person or thing that
  this item is about. Maybe it is an insurance contract about your
  car.
- ...

### Collective

The users of the application are part of a **collective**. A
**collective** is a group of users that share access to the same
items. The account name is therefore comprised of a *collective name*
and a *user name*.

All users of a collective are equal; they have same permissions to
access all...
</code></pre></div></div>

<p>Then a plain text file is tried, too (without any markup).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Maecenas mauris lectus, lobortis et purus mattis

Duis vehicula mi vel mi pretium

In non mauris justo. Duis vehicula mi vel mi pretium, a viverra erat efficitur. Cras aliquam est ac eros varius, id iaculis dui auctor. Duis pretium neque ligula, et pulvinar mi placerat et. Nulla nec nunc sit amet nunc posuere vestibulum. Ut id neque eget tortor mattis tristique. Donec ante est, blandit sit amet tristique vel, lacinia pulvinar arcu.

Pellentesque scelerisque fermentum erat, id posuere justo pulvinar ut.
Cras id eros sed enim aliquam lobortis. Sed lobortis nisl ut eros
efficitur tincidunt. Cras justo mi, porttitor quis mattis vel,
ultricies ut purus. Ut facilisis et lacus eu cursus.

In eleifend velit vitae libero sollicitudin euismod:

- Fusce vitae vestibulum velit,
- Pellentesque vulputate lectus quis pellentesque commodo

the end.
</code></pre></div></div>

<h2 id="considered-options">Considered Options</h2>

<ul>
  <li><a href="https://github.com/vsch/flexmark-java">flexmark</a> for markdown to
HTML, then use existing machinery described in <a href="./0007_convert_html_files">adr
7</a></li>
  <li><a href="https://pandoc.org/">pandoc</a> external command</li>
</ul>

<h3 id="flexmark-markdown-library-for-java">flexmark markdown library for java</h3>

<p>Process files with <a href="https://github.com/vsch/flexmark-java">flexmark</a>
and then create a PDF from the resulting html.</p>

<p>Using the following snippet:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">renderMarkdown</span><span class="o">()</span><span class="k">:</span> <span class="kt">ExitCode</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">opts</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MutableDataSet</span><span class="o">()</span>
    <span class="nv">opts</span><span class="o">.</span><span class="py">set</span><span class="o">(</span><span class="nv">Parser</span><span class="o">.</span><span class="py">EXTENSIONS</span><span class="o">.</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">DataKey</span><span class="o">[</span><span class="kt">util.Collection</span><span class="o">[</span><span class="k">_</span><span class="o">]]],</span>
      <span class="nv">util</span><span class="o">.</span><span class="py">Arrays</span><span class="o">.</span><span class="py">asList</span><span class="o">(</span><span class="nv">TablesExtension</span><span class="o">.</span><span class="py">create</span><span class="o">(),</span>
      <span class="nv">StrikethroughExtension</span><span class="o">.</span><span class="py">create</span><span class="o">()));</span>

    <span class="k">val</span> <span class="nv">parser</span> <span class="k">=</span> <span class="nv">Parser</span><span class="o">.</span><span class="py">builder</span><span class="o">(</span><span class="n">opts</span><span class="o">).</span><span class="py">build</span><span class="o">()</span>
    <span class="k">val</span> <span class="nv">renderer</span> <span class="k">=</span> <span class="nv">HtmlRenderer</span><span class="o">.</span><span class="py">builder</span><span class="o">(</span><span class="n">opts</span><span class="o">).</span><span class="py">build</span><span class="o">()</span>
    <span class="k">val</span> <span class="nv">reader</span> <span class="k">=</span> <span class="nv">Files</span><span class="o">.</span><span class="py">newBufferedReader</span><span class="o">(</span><span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="s">"in.txt|md"</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">doc</span> <span class="k">=</span> <span class="nv">parser</span><span class="o">.</span><span class="py">parseReader</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">html</span> <span class="k">=</span> <span class="nv">renderer</span><span class="o">.</span><span class="py">render</span><span class="o">(</span><span class="n">doc</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">body</span> <span class="k">=</span> <span class="s">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body style=\"padding: 0 5em;\"&gt;"</span> <span class="o">+</span> <span class="n">html</span> <span class="o">+</span> <span class="s">"&lt;/body&gt;&lt;/html&gt;"</span>
    <span class="nv">Files</span><span class="o">.</span><span class="py">write</span><span class="o">(</span>
      <span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="s">"test.html"</span><span class="o">),</span>
      <span class="nv">body</span><span class="o">.</span><span class="py">getBytes</span><span class="o">(</span><span class="nv">StandardCharsets</span><span class="o">.</span><span class="py">UTF_8</span><span class="o">))</span>

    <span class="nv">ExitCode</span><span class="o">.</span><span class="py">Success</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>Then run the result through <code class="highlighter-rouge">wkhtmltopdf</code>.</p>

<p>Markdown file:</p>
<div class="thumbnail">
  <img src="./img/example-md-java.jpg" title="Flexmark/wkhtmltopdf MD-&gt;PDF" />
</div>

<p>TXT file:</p>
<div class="thumbnail">
  <img src="./img/example-txt-java.jpg" title="Flexmark/wkhtmltopdf TXT-&gt;PDF" />
</div>

<h3 id="pandoc">pandoc</h3>

<p>Command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc -f markdown -t html -o test.pdf microsite/docs/doc.md
</code></pre></div></div>

<p>Markdown/Latex:</p>
<div class="thumbnail">
  <img src="./img/example-md-pandoc-latex.jpg" title="Pandoc (Latex) MD-&gt;PDF" />
</div>

<p>Markdown/Html:</p>
<div class="thumbnail">
  <img src="./img/example-md-pandoc-html.jpg" title="Pandoc (html) MD-&gt;PDF" />
</div>

<p>Text/Latex:</p>
<div class="thumbnail">
  <img src="./img/example-txt-pandoc-latex.jpg" title="Pandoc (Latex) TXT-&gt;PDF" />
</div>

<p>Text/Html:</p>
<div class="thumbnail">
  <img src="./img/example-txt-pandoc-html.jpg" title="Pandoc (html) TXT-&gt;PDF" />
</div>

<h2 id="decision-outcome">Decision Outcome</h2>

<p>Java library “flexmark”.</p>

<p>I think all results are great. It depends on the type of document and
what one expects to see. I guess that most people expect something
like pandoc-html produces for the kind of files docspell is for (it is
not for newspaper articles, where pandoc-latex would be best fit).</p>

<p>But choosing pandoc means yet another external command to depend on.
And the results from flexmark are really good, too. One can fiddle
with options and css to make it look better.</p>

<p>To not introduce another external command, decision is to use flexmark
and then the already existing html-&gt;pdf conversion.</p>
</section><div class="edit-button"><a href="https://github.com/eikek/docspell/edit/master/modules/microsite/docs/dev/adr/0008_convert_plain_text.md" target="_blank" rel="noopener noreferrer" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','json','javascript']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/docs.js"></script></body></html>