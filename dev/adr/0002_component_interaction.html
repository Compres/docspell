<html><head><title>Docspell: Component Interaction</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Docspell – A Document Organizer" /><meta name="og:image" content="/docspell/img/poster.png" /><meta name="image" property="og:image" content="/docspell/img/poster.png" /><meta name="og:title" content="Docspell: Component Interaction" /><meta name="title" property="og:title" content="Docspell: Component Interaction" /><meta name="og:site_name" content="Docspell" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Docspell – A Document Organizer" /><link rel="icon" type="image/png" href="/docspell/img/favicon.png" /><meta name="twitter:title" content="Docspell: Component Interaction" /><meta name="twitter:image" content="/docspell/img/poster.png" /><meta name="twitter:description" content="Docspell – A Document Organizer" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/docspell/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/docspell/highlight/styles/default.css" /><link rel="stylesheet" href="/docspell/css/style.css" /><link rel="stylesheet" href="/docspell/css/palette.css" /><link rel="stylesheet" href="/docspell/css/codemirror.css" /><link rel="stylesheet" href="/docspell/css/docspell.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/docspell/" class="brand"><div class="brand-wrapper"><span>Docspell</span></div></a></li> <li><a href="/docspell/index.html" class="">Home</a></li> <li><a href="/docspell/getit.html" class="">Getit</a></li> <li><a href="/docspell/doc.html" class="">Documentation</a> <ul class="sub_section"> <li><a href="/docspell/doc/install.html" class="">Installation</a></li> <li><a href="/docspell/doc/configure.html" class="">Configuring</a></li> <li><a href="/docspell/doc/metadata.html" class="">Adding Meta Data</a></li> <li><a href="/docspell/doc/uploading.html" class="">Uploads</a></li> <li><a href="/docspell/doc/processing.html" class="">Processing Queue</a></li> <li><a href="/docspell/doc/curate.html" class="">Find and Review</a></li> <li><a href="/docspell/doc/joex.html" class="">Joex</a></li></ul></li> <li><a href="/docspell/dev.html" class="">Development</a> <ul class="sub_section"> <li><a href="/docspell/dev/adr.html" class=""></a></li></ul></li> <li><a href="/docspell/api.html" class="">Api</a> <ul class="sub_section"> <li><a href="/docspell/openapi/docspell-openapi.html" class="">REST Api Doc</a></li> <li><a href="/docspell/openapi/docspell-openapi.yml" class="">REST OpenApi Spec</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/docspell"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/docspell"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="docspell"><div class="content-wrapper"><section><h1 id="component-interaction">Component Interaction</h1>

<h2 id="context-and-problem-statement">Context and Problem Statement</h2>

<p>There are multiple web applications with their rest servers and there
are multiple document processors. These processes must communicate:</p>

<ul>
  <li>once a new job is added to the queue the rest server must somehow
notify processors to wake up</li>
  <li>once a processor takes a job, it must propagate the progress and
outcome to all rest servers only that the rest server can notify the
user that is currently logged in. Since it’s not known which
rest-server the user is using right now, all must be notified.</li>
</ul>

<h2 id="considered-options">Considered Options</h2>

<ol>
  <li>JMS: Message Broker as another active component</li>
  <li>Akka: using a cluster</li>
  <li>DB: Register with “call back urls”</li>
</ol>

<h2 id="decision-outcome">Decision Outcome</h2>

<p>Choosing option 3: DB as central synchronisation point.</p>

<p>The reason is that this is the simplest solution and doesn’t require
external libraries or more processes. The other options seem too big
of a weapon for the task at hand.</p>

<p>It works roughly like this:</p>

<ul>
  <li>rest servers and processors register at the database on startup each
with a unique call-back url</li>
  <li>and deregister on shutdown</li>
  <li>each component has db access</li>
  <li>rest servers can list all processors and vice versa</li>
</ul>

<h3 id="positive-consequences">Positive Consequences</h3>

<ul>
  <li>complexity of the whole application is not touched</li>
  <li>since a lot of data must be transferred to the document processors,
this is solved by simply accessing the db. So the protocol for data
exchange is set. There is no need for other protocols that handle
large data (http chunking etc)</li>
  <li>uses the already exsting db as synchronisation point</li>
  <li>no additional knowledge required</li>
  <li>simple to understand and so not hard to debug</li>
</ul>

<h3 id="negative-consequences">Negative Consequences</h3>

<ul>
  <li>all components must have db access. this also is a negative point,
because if one of those processes is hacked, db access is
possible. and it simply is another dependency that may not be
required for the document processors</li>
  <li>the document processors cannot be in a untrusted environment
(untrusted from the db’s point of view). it would be for example
possible to create personal processors that only receive your own
jobs…</li>
  <li>in order to know if a component is really active, one must run a
ping against the call-back url</li>
</ul>

<h2 id="pros-and-cons-of-the-options">Pros and Cons of the Options</h2>

<h3 id="jms-message-broker">JMS Message Broker</h3>

<ul>
  <li>pro: offers publish-subscribe out of the box</li>
  <li>con: another central point of failure</li>
  <li>con: requires setup and maintenance</li>
  <li>con: complexity of whole app is strongly increased, there are now at
least 3 processes</li>
</ul>

<h3 id="akka-cluster">Akka Cluster</h3>

<ul>
  <li>pro: publish subscribe</li>
  <li>pro: no central component or separate process</li>
  <li>con: only works reliably in a “real cluster”, where 3 nodes is a
minimum. Thus it wouldn’t allow a light-weight setup of the
application</li>
  <li>con: introduces a new technology that is not easy to understand and
maintain (the cluster, gossip protocol etc) requires to be “good at
akka”</li>
</ul>

<h3 id="db-sync">DB Sync</h3>

<ul>
  <li>pro: simple and intuitive</li>
  <li>pro: no one more central point of failure</li>
  <li>pro: requires no additional knowledge or setup</li>
  <li>cons: all components require db access</li>
</ul>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/docspell/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/json.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script><script>hljs.configure({languages:['scala','java','bash','json','javascript']});
hljs.initHighlighting();
              </script><script src="/docspell/js/main.js"></script></body></html>