<!DOCTYPE html><html><head><title>Docspell: Convert Image Files</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Auto-tagging Document Organizer" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Docspell: Convert Image Files" /><meta name="title" property="og:title" content="Docspell: Convert Image Files" /><meta name="og:site_name" content="Docspell" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Auto-tagging Document Organizer" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Docspell: Convert Image Files" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="Auto-tagging Document Organizer" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/docspell.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Docspell</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/demo" title="Demo" class="">Demo</a></div> <div class="sidebar-nav-item  "><a href="/getit" title="Quickstart" class="">Quickstart</a></div> <div class="sidebar-nav-item  "><a href="/features" title="Features/Limitations" class="">Features/Limitations</a></div> <div class="sidebar-nav-item  "><a href="/doc" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/install" title="Installation" class="">Installation</a> <a href="/doc/configure" title="Configuring" class="">Configuring</a> <a href="/doc/nix" title="Nix/NixOS" class="">Nix/NixOS</a> <a href="/doc/reverseproxy" title="Reverse Proxy" class="">Reverse Proxy</a> <a href="/doc/metadata" title="Adding Meta Data" class="">Adding Meta Data</a> <a href="/doc/finding" title="Finding Items" class="">Finding Items</a> <a href="/doc/curate" title="Curate Metadata" class="">Curate Metadata</a> <a href="/doc/uploading" title="Uploads" class="">Uploads</a> <a href="/doc/processing" title="Processing Queue" class="">Processing Queue</a> <a href="/doc/emailsettings" title="E-Mail Settings" class="">E-Mail Settings</a> <a href="/doc/mailitem" title="Send via E-Mail" class="">Send via E-Mail</a> <a href="/doc/notifydueitems" title="Notify on due Items" class="">Notify on due Items</a> <a href="/doc/scanmailbox" title="Scan Mailboxes" class="">Scan Mailboxes</a> <a href="/doc/joex" title="Joex" class="">Joex</a></div></div> <div class="sidebar-nav-item  "><a href="/doc/tools" title="Tools" class="drop-nested">Tools</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/tools/ds" title="Upload CLI" class="">Upload CLI</a> <a href="/doc/tools/consumedir" title="Consume Directory" class="">Consume Directory</a> <a href="/doc/tools/browserext" title="Browser Extension (Firefox)" class="">Browser Extension (Firefox)</a> <a href="/doc/tools/smtpgateway" title="SMTP Gateway" class="">SMTP Gateway</a></div></div> <div class="sidebar-nav-item  "><a href="/api" title="Api" class="drop-nested">Api</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/openapi/docspell-openapi.html" title="REST Api Doc" class="">REST Api Doc</a> <a href="/openapi/docspell-openapi.yml" title="REST OpenApi Spec" class="">REST OpenApi Spec</a></div></div> <div class="sidebar-nav-item  "><a href="/dev" title="Development" class="drop-nested">Development</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/dev/adr" title="ADRs" class="">ADRs</a></div></div> <div class="sidebar-nav-item  "><a href="/changelog" title="Changelog" class="">Changelog</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="docspell"><div class="content-wrapper"><section><h1 id="convert-image-files">Convert Image Files</h1>

<h2 id="context-and-problem-statement">Context and Problem Statement</h2>

<p>How to convert image files properly to pdf?</p>

<p>Since there are thousands of different image formats, there will never
be support for all. The most common containers should be supported,
though:</p>

<ul>
  <li>jpeg (jfif, exif)</li>
  <li>png</li>
  <li>tiff (baseline, single page)</li>
</ul>

<p>The focus is on document images, maybe from digital cameras or
scanners.</p>

<h2 id="considered-options">Considered Options</h2>

<ul>
  <li><a href="">pdfbox</a> library</li>
  <li><a href="https://www.imagemagick.org/">imagemagick</a> external command</li>
  <li><a href="https://github.com/josch/img2pdf">img2pdf</a> external command</li>
  <li><a href="https://github.com/tesseract-ocr/tesseract">tesseract</a> external command</li>
</ul>

<p>There are no screenshots here, because it doesnâ€™t make sense since
they all look the same on the screen. Instead we look at the files
properties.</p>

<p><strong>Input File</strong></p>

<p>The input files are:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ identify input/*
input/jfif.jpg JPEG 2480x3514 2480x3514+0+0 8-bit sRGB 240229B 0.000u 0:00.000
input/letter-en.jpg JPEG 1695x2378 1695x2378+0+0 8-bit Gray 256c 467341B 0.000u 0:00.000
input/letter-en.png PNG 1695x2378 1695x2378+0+0 8-bit Gray 256c 191571B 0.000u 0:00.000
input/letter-en.tiff TIFF 1695x2378 1695x2378+0+0 8-bit Grayscale Gray 4030880B 0.000u 0:00.000
</code></pre></div></div>

<p>Size:</p>
<ul>
  <li>jfif.jpg 240k</li>
  <li>letter-en.jpg 467k</li>
  <li>letter-en.png 191k</li>
  <li>letter-en.tiff 4.0M</li>
</ul>

<h3 id="pdfbox">pdfbox</h3>

<p>Using a java library is preferred, if the quality is good enough.
There is an
<a href="https://github.com/apache/pdfbox/blob/2cea31cc63623fd6ece149c60d5f0cc05a696ea7/examples/src/main/java/org/apache/pdfbox/examples/pdmodel/ImageToPDF.java">example</a>
for this exact use case.</p>

<p>This is the sample code:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">imgtopdf</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">ExitCode</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">jpg</span> <span class="k">=</span> <span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="n">file</span><span class="o">).</span><span class="py">toAbsolutePath</span>
  <span class="nf">if</span> <span class="o">(!</span><span class="nv">Files</span><span class="o">.</span><span class="py">exists</span><span class="o">(</span><span class="n">jpg</span><span class="o">))</span> <span class="o">{</span>
    <span class="nv">sys</span><span class="o">.</span><span class="py">error</span><span class="o">(</span><span class="n">s</span><span class="s">"file doesn't exist: $jpg"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="k">val</span> <span class="nv">pd</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PDDocument</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">page</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PDPage</span><span class="o">(</span><span class="nv">PDRectangle</span><span class="o">.</span><span class="py">A4</span><span class="o">)</span>
  <span class="nv">pd</span><span class="o">.</span><span class="py">addPage</span><span class="o">(</span><span class="n">page</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">bimg</span> <span class="k">=</span> <span class="nv">ImageIO</span><span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="nv">jpg</span><span class="o">.</span><span class="py">toFile</span><span class="o">)</span>

  <span class="k">val</span> <span class="nv">img</span> <span class="k">=</span> <span class="nv">LosslessFactory</span><span class="o">.</span><span class="py">createFromImage</span><span class="o">(</span><span class="n">pd</span><span class="o">,</span> <span class="n">bimg</span><span class="o">)</span>

  <span class="k">val</span> <span class="nv">stream</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PDPageContentStream</span><span class="o">(</span><span class="n">pd</span><span class="o">,</span> <span class="n">page</span><span class="o">)</span>
  <span class="nv">stream</span><span class="o">.</span><span class="py">drawImage</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">PDRectangle</span><span class="o">.</span><span class="py">A4</span><span class="o">.</span><span class="py">getWidth</span><span class="o">,</span> <span class="nv">PDRectangle</span><span class="o">.</span><span class="py">A4</span><span class="o">.</span><span class="py">getHeight</span><span class="o">)</span>
  <span class="nv">stream</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>

  <span class="nv">pd</span><span class="o">.</span><span class="py">save</span><span class="o">(</span><span class="s">"test.pdf"</span><span class="o">)</span>
  <span class="nv">pd</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>

  <span class="nv">ExitCode</span><span class="o">.</span><span class="py">Success</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Using pdfbox 2.0.18 and twelvemonkeys 3.5. Running time: <code class="highlighter-rouge">1384ms</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ identify *.pdf
jfif.jpg.pdf PDF 595x842 595x842+0+0 16-bit sRGB 129660B 0.000u 0:00.000
letter-en.jpg.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49118B 0.000u 0:00.000
letter-en.png.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49118B 0.000u 0:00.000
letter-en.tiff.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49118B 0.000u 0:00.000
</code></pre></div></div>

<p>Size:</p>
<ul>
  <li>jfif.jpg 1.1M</li>
  <li>letter-en.jpg 142k</li>
  <li>letter-en.png 142k</li>
  <li>letter-en.tiff 142k</li>
</ul>

<h3 id="img2pdf">img2pdf</h3>

<p>This is a python tool that adds the image into the pdf without
reencoding.</p>

<p>Using version 0.3.1. Running time: <code class="highlighter-rouge">323ms</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ identify *.pdf
jfif.jpg.pdf PDF 595x842 595x842+0+0 16-bit sRGB 129708B 0.000u 0:00.000
letter-en.jpg.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49864B 0.000u 0:00.000
letter-en.png.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49864B 0.000u 0:00.000
letter-en.tiff.pdf PDF 595x842 595x842+0+0 16-bit sRGB 49864B 0.000u 0:00.000
</code></pre></div></div>

<p>Size:</p>
<ul>
  <li>jfif.jpg 241k</li>
  <li>letter-en.jpg 468k</li>
  <li>letter-en.png 191k</li>
  <li>letter-en.tiff 192k</li>
</ul>

<h3 id="imagemagick">ImageMagick</h3>

<p>The well known imagemagick tool can convert images to pdfs, too.</p>

<p>Using version 6.9.10-71. Running time: <code class="highlighter-rouge">881ms</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ identify *.pdf
jfif.jpg.pdf PDF 595x843 595x843+0+0 16-bit sRGB 134873B 0.000u 0:00.000
letter-en.jpg.pdf PDF 1695x2378 1695x2378+0+0 16-bit sRGB 360100B 0.000u 0:00.000
letter-en.png.pdf PDF 1695x2378 1695x2378+0+0 16-bit sRGB 322418B 0.000u 0:00.000
letter-en.tiff.pdf PDF 1695x2378 1695x2378+0+0 16-bit sRGB 322418B 0.000u 0:00.000
</code></pre></div></div>

<p>Size:</p>
<ul>
  <li>jfif.jpg 300k</li>
  <li>letter-en.jpg 390k</li>
  <li>letter-en.png 180k</li>
  <li>letter-en.tiff 5.1M</li>
</ul>

<h3 id="tesseract">Tesseract</h3>

<p>Docspell already relies on tesseract for doing OCR. And in contrast to
all other candidates, it can create PDFs that are searchable. Of
course, this yields in much longer running time, that cannot be
compared to the times of the other options.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tesseract doc3.jpg out -l deu pdf
</code></pre></div></div>

<p>It can also create both outputs in one go:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tesseract doc3.jpg out -l deu pdf txt
</code></pre></div></div>

<p>Using tesseract 4. Running time: <code class="highlighter-rouge">6661ms</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ identify *.pdf
tesseract/jfif.jpg.pdf PDF 595x843 595x843+0+0 16-bit sRGB 130535B 0.000u 0:00.000
tesseract/letter-en.jpg.pdf PDF 1743x2446 1743x2446+0+0 16-bit sRGB 328716B 0.000u 0:00.000
tesseract/letter-en.png.pdf PDF 1743x2446 1743x2446+0+0 16-bit sRGB 328716B 0.000u 0:00.000
tesseract/letter-en.tiff.pdf PDF 1743x2446 1743x2446+0+0 16-bit sRGB 328716B 0.000u 0:00.000
</code></pre></div></div>

<p>Size:</p>
<ul>
  <li>jfif.jpg 246k</li>
  <li>letter-en.jpg 473k</li>
  <li>letter-en.png 183k</li>
  <li>letter-en.tiff 183k</li>
</ul>

<h2 id="decision">Decision</h2>

<p>Tesseract.</p>

<p>To not use more external tools, imagemagick and img2pdf are not
chosen, even though img2pdf shows the best results and is fastest.</p>

<p>Pdfbox library would be the favorite, because results are good and
with the <a href="https://github.com/haraldk/TwelveMonkeys">twelvemonkeys</a>
library there is support for many images. The priority is to avoid
more external commands if possible.</p>

<p>But since there already is a dependency to tesseract and it can create
searchable pdfs, the decision is to use tesseract for this. Then PDFs
with images can be converted to searchable PDFs with images. And text
extraction is required anyways.</p>
</section><div class="edit-button"><a href="https://github.com/eikek/docspell/edit/master/modules/microsite/docs/dev/adr/0010_convert_image_files.md" target="_blank" rel="noopener noreferrer" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','json','javascript']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/docs.js"></script></body></html>