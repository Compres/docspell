<!DOCTYPE html><html><head><title>Docspell: Convert Office Documents</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Auto-tagging Document Organizer" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Docspell: Convert Office Documents" /><meta name="title" property="og:title" content="Docspell: Convert Office Documents" /><meta name="og:site_name" content="Docspell" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Auto-tagging Document Organizer" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Docspell: Convert Office Documents" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="Auto-tagging Document Organizer" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/docspell.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Docspell</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/demo.html" title="Demo" class="">Demo</a></div> <div class="sidebar-nav-item  "><a href="/getit" title="Quickstart" class="">Quickstart</a></div> <div class="sidebar-nav-item  "><a href="/features.html" title="Features/Limitations" class="">Features/Limitations</a></div> <div class="sidebar-nav-item  "><a href="/doc.html" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/install.html" title="Installation" class="">Installation</a> <a href="/doc/configure.html" title="Configuring" class="">Configuring</a> <a href="/doc/nix" title="Nix/NixOS" class="">Nix/NixOS</a> <a href="/doc/reverseproxy" title="Reverse Proxy" class="">Reverse Proxy</a> <a href="/doc/metadata.html" title="Adding Meta Data" class="">Adding Meta Data</a> <a href="/doc/uploading.html" title="Uploads" class="">Uploads</a> <a href="/doc/processing.html" title="Processing Queue" class="">Processing Queue</a> <a href="/doc/curate.html" title="Find and Review" class="">Find and Review</a> <a href="/doc/mailitem.html" title="Send via E-Mail" class="">Send via E-Mail</a> <a href="/doc/joex.html" title="Joex" class="">Joex</a> <a href="/doc/tools.html" title="Tools" class="">Tools</a></div></div> <div class="sidebar-nav-item  "><a href="/changelog" title="Changelog" class="">Changelog</a></div> <div class="sidebar-nav-item  "><a href="/dev.html" title="Development" class="drop-nested">Development</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/dev/adr.html" title="" class=""></a></div></div> <div class="sidebar-nav-item  "><a href="/api.html" title="Api" class="drop-nested">Api</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/openapi/docspell-openapi.html" title="REST Api Doc" class="">REST Api Doc</a> <a href="/openapi/docspell-openapi.yml" title="REST OpenApi Spec" class="">REST OpenApi Spec</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="docspell"><div class="content-wrapper"><section><h1 id="convert-office-documents">Convert Office Documents</h1>

<h2 id="context-and-problem-statement">Context and Problem Statement</h2>

<p>How can office documents, like <code class="highlighter-rouge">docx</code> or <code class="highlighter-rouge">odt</code> be converted into a PDF
file that looks as much as possible like the original?</p>

<p>It would be nice to have a java-only solution. But if an external tool
has a better outcome, then an external tool is fine, too.</p>

<p>Since Docspell is free software, the tools must also be free.</p>

<h2 id="considered-options">Considered Options</h2>

<ul>
  <li><a href="https://poi.apache.org">Apache POI</a> together with
<a href="https://search.maven.org/artifact/fr.opensagres.xdocreport/org.apache.poi.xwpf.converter.pdf/1.0.6/jar">this</a>
library</li>
  <li><a href="https://pandoc.org/">pandoc</a> external command</li>
  <li><a href="">abiword</a> external command</li>
  <li><a href="https://github.com/unoconv/unoconv">Unoconv</a> external command</li>
</ul>

<p>To choose an option, some documents are converted to pdf and compared.
Only the formats <code class="highlighter-rouge">docx</code> and <code class="highlighter-rouge">odt</code> are considered here. These are the
most used formats. They have to look well, if a <code class="highlighter-rouge">xlsx</code> or <code class="highlighter-rouge">pptx</code>
doesn’t look so great, that is ok.</p>

<p>Here is the native view to compare with:</p>

<p>ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-native.jpg" title="Native view of an ODT example file" />
</div>

<h3 id="xwpfconverter"><code class="highlighter-rouge">XWPFConverter</code></h3>

<p>I couldn’t get any example to work. There were exceptions:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.lang.IllegalArgumentException: Value for parameter 'id' was out of bounds
    at org.apache.poi.util.IdentifierManager.reserve(IdentifierManager.java:80)
    at org.apache.poi.xwpf.usermodel.XWPFRun.&lt;init&gt;(XWPFRun.java:101)
    at org.apache.poi.xwpf.usermodel.XWPFRun.&lt;init&gt;(XWPFRun.java:146)
    at org.apache.poi.xwpf.usermodel.XWPFParagraph.buildRunsInOrderFromXml(XWPFParagraph.java:135)
    at org.apache.poi.xwpf.usermodel.XWPFParagraph.&lt;init&gt;(XWPFParagraph.java:88)
    at org.apache.poi.xwpf.usermodel.XWPFDocument.onDocumentRead(XWPFDocument.java:147)
    at org.apache.poi.POIXMLDocument.load(POIXMLDocument.java:159)
    at org.apache.poi.xwpf.usermodel.XWPFDocument.&lt;init&gt;(XWPFDocument.java:124)
    at docspell.convert.Testing$.withPoi(Testing.scala:17)
    at docspell.convert.Testing$.$anonfun$run$1(Testing.scala:12)
    at cats.effect.internals.IORunLoop$.cats$effect$internals$IORunLoop$$loop(IORunLoop.scala:87)
    at cats.effect.internals.IORunLoop$RestartCallback.signal(IORunLoop.scala:355)
    at cats.effect.internals.IORunLoop$RestartCallback.apply(IORunLoop.scala:376)
    at cats.effect.internals.IORunLoop$RestartCallback.apply(IORunLoop.scala:316)
    at cats.effect.internals.IOShift$Tick.run(IOShift.scala:36)
    at cats.effect.internals.PoolUtils$$anon$2$$anon$3.run(PoolUtils.scala:51)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    at java.lang.Thread.run(Thread.java:748)
</code></pre></div></div>

<p>The project (not Apache Poi, the other) seems unmaintained. I could
not find any website and the artifact in maven central is from 2016.</p>

<h3 id="pandoc">Pandoc</h3>

<p>I know pandoc as a very great tool when converting between markup
documents. So this tries it with office documents. It supports <code class="highlighter-rouge">docx</code>
and <code class="highlighter-rouge">odt</code> from there <code class="highlighter-rouge">--list-input-formats</code>.</p>

<p>From the pandoc manual:</p>

<blockquote>
  <p>By default, pandoc will use LaTeX to create the PDF, which requires
that a LaTeX engine be installed (see –pdf-engine below).
Alternatively, pandoc can use ConTeXt, roff ms, or HTML as an
intermediate format. To do this, specify an output file with a .pdf
extension, as before, but add the –pdf-engine option or -t context,
-t html, or -t ms to the command line. The tool used to generate the
PDF from the intermediate format may be specified using –pdf-engine.</p>
</blockquote>

<p>Trying with latex engine:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc -f odt -o test.pdf example.odt
</code></pre></div></div>

<p>Results ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-pandoc-latex.jpg" title="Pandoc (Latex) ODT-&gt;PDF" />
</div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc -f odt -o test.pdf example.docx
</code></pre></div></div>

<p>Results DOCX:</p>

<div class="thumbnail">
  <img src="./img/example-docx-pandoc-latex.jpg" title="Pandoc (Latex) DOCX-&gt;PDF" />
</div>

<hr />

<p>Trying with context engine:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc -f odt -t context -o test.pdf example.odt
</code></pre></div></div>

<p>Results ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-pandoc-context.jpg" title="Pandoc (Context) ODT-&gt;PDF" />
</div>

<p>Results DOCX:</p>

<div class="thumbnail">
  <img src="./img/example-docx-pandoc-context.jpg" title="Pandoc (Context) DOCX-&gt;PDF" />
</div>

<hr />

<p>Trying with ms engine:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc -f odt -t ms -o test.pdf example.odt
</code></pre></div></div>

<p>Results ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-pandoc-ms.jpg" title="Pandoc (MS) ODT-&gt;PDF" />
</div>

<p>Results DOCX:</p>

<div class="thumbnail">
  <img src="./img/example-docx-pandoc-ms.jpg" title="Pandoc (MS) DOCX-&gt;PDF" />
</div>

<hr />

<p>Trying with html engine (this requires <code class="highlighter-rouge">wkhtmltopdf</code> to be present):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pandoc --extract-media . -f odt -t html -o test.pdf example.odt
</code></pre></div></div>

<p>Results ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-pandoc-html.jpg" title="Pandoc (html) ODT-&gt;PDF" />
</div>

<p>Results DOCX:</p>

<div class="thumbnail">
  <img src="./img/example-docx-pandoc-html.jpg" title="Pandoc (html) DOCX-&gt;PDF" />
</div>

<h3 id="abiword">Abiword</h3>

<p>Trying with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>abiword --to=pdf example.odt
</code></pre></div></div>

<p>Results:</p>

<div class="thumbnail">
  <img src="./img/example-odt-abiword.jpg" title="Abiword ODT-&gt;PDF" />
</div>

<p>Trying with a <code class="highlighter-rouge">docx</code> file failed. It worked with a <code class="highlighter-rouge">doc</code> file.</p>

<h3 id="unoconv">Unoconv</h3>

<p>Unoconv relies on libreoffice/openoffice, so installing it will result
in installing parts of libreoffice, which is a very large dependency.</p>

<p>Trying with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unoconv -f pdf example.odt
</code></pre></div></div>

<p>Results ODT:</p>

<div class="thumbnail">
  <img src="./img/example-odt-unoconv.jpg" title="Unoconv ODT-&gt;PDF" />
</div>

<p>Results DOCX:</p>

<div class="thumbnail">
  <img src="./img/example-docx-unoconv.jpg" title="Unoconv ODT-&gt;PDF" />
</div>

<h2 id="decision-outcome">Decision Outcome</h2>

<p>Unoconv.</p>

<p>The results from <code class="highlighter-rouge">unoconv</code> are really good.</p>

<p>Abiword also is not that bad, it didn’t convert the chart, but all
font markup is there. It would be great to not depend on something as
big as libreoffice, but the results are so much better.</p>

<p>Also pandoc deals very well with DOCX files (using the <code class="highlighter-rouge">context</code>
engine). The only thing that was not rendered was the embedded chart
(like abiword). But all images and font styling was present.</p>

<p>It will be a configurable external command anyways, so users can
exchange it at any time with a different one.</p>
</section><div class="edit-button"><a href="https://github.com/eikek/docspell/edit/master/modules/microsite/docs/dev/adr/0009_convert_office_docs.md" target="_blank" rel="noopener noreferrer" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','json','javascript']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/docs.js"></script></body></html>