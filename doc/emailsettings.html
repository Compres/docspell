<!DOCTYPE html><html><head><title>Docspell: E-Mail Settings</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Auto-tagging Document Organizer" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Docspell: E-Mail Settings" /><meta name="title" property="og:title" content="Docspell: E-Mail Settings" /><meta name="og:site_name" content="Docspell" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Auto-tagging Document Organizer" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Docspell: E-Mail Settings" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="Auto-tagging Document Organizer" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/light-style.css" /><link rel="stylesheet" href="/css/docspell.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Docspell</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/demo" title="Demo" class="">Demo</a></div> <div class="sidebar-nav-item  "><a href="/getit" title="Quickstart" class="">Quickstart</a></div> <div class="sidebar-nav-item  "><a href="/features" title="Features/Limitations" class="">Features/Limitations</a></div> <div class="sidebar-nav-item  open"><a href="/doc" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/install" title="Installation" class="">Installation</a> <a href="/doc/configure" title="Configuring" class="">Configuring</a> <a href="/doc/nix" title="Nix/NixOS" class="">Nix/NixOS</a> <a href="/doc/reverseproxy" title="Reverse Proxy" class="">Reverse Proxy</a> <a href="/doc/metadata" title="Adding Meta Data" class="">Adding Meta Data</a> <a href="/doc/uploading" title="Uploads" class="">Uploads</a> <a href="/doc/processing" title="Processing Queue" class="">Processing Queue</a> <a href="/doc/curate" title="Find and Review" class="">Find and Review</a> <a href="/doc/emailsettings" title="E-Mail Settings" class="active">E-Mail Settings</a> <a href="/doc/mailitem" title="Send via E-Mail" class="">Send via E-Mail</a> <a href="/doc/notifydueitems" title="Notify on due Items" class="">Notify on due Items</a> <a href="/doc/scanmailbox" title="Scan Mailboxes" class="">Scan Mailboxes</a> <a href="/doc/joex" title="Joex" class="">Joex</a></div></div> <div class="sidebar-nav-item  "><a href="/doc/tools" title="Tools" class="drop-nested">Tools</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/doc/tools/ds" title="Upload CLI" class="">Upload CLI</a> <a href="/doc/tools/consumedir" title="Consume Directory" class="">Consume Directory</a> <a href="/doc/tools/browserext" title="Browser Extension (Firefox)" class="">Browser Extension (Firefox)</a></div></div> <div class="sidebar-nav-item  "><a href="/dev" title="Development" class="drop-nested">Development</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/dev/adr" title="ADRs" class="">ADRs</a></div></div> <div class="sidebar-nav-item  "><a href="/api" title="Api" class="drop-nested">Api</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/openapi/docspell-openapi.html" title="REST Api Doc" class="">REST Api Doc</a> <a href="/openapi/docspell-openapi.yml" title="REST OpenApi Spec" class="">REST OpenApi Spec</a></div></div> <div class="sidebar-nav-item  "><a href="/changelog" title="Changelog" class="">Changelog</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/docspell" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="docspell"><div class="content-wrapper"><section><h1 id="e-mail-settings">E-Mail Settings</h1>

<p>Docspell has a good integration for E-Mail. You can send e-mails
related to an item and you can import e-mails from your mailbox into
docspell.</p>

<p>This requires to define settings to use for sending and receiving
e-mails. E-Mails are commonly send via
<a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">SMTP</a>
and for receiving
<a href="https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol">IMAP</a>
is quite common. Docspell has support for SMTP and IMAP. These
settings are associated to a user, so that each user can specify its
own settings separately from others in the collective.</p>

<p><em>Note: Passwords to your e-mail accounts are stored in plain-text in
docspell’s database. This is necessary to have docspell connect to
your e-mail account to send mails on behalf of you and receive your
mails.</em></p>

<h2 id="smtp-settings">SMTP Settings</h2>

<p>For sending mail, you need to provide information to connect to a SMTP
server. Every e-mail provider has this information somewhere
available.</p>

<p>Configure this in <em>User Settings -&gt; E-Mail Settings (SMTP)</em>:</p>

<div class="thumbnail">
  <img src="../img/mail-settings-1.png" />
</div>

<p>First, you need to provide some name that is used to recognize this
account. This name is also used in URLs to docspell and so it must not
contain whitespace or any special characters. A good value is the
domain of your provider, for example <code class="highlighter-rouge">gmail.com</code>, or something like
that.</p>

<p>These information should be available from your e-mail provider. For
example, for google-mail it is:</p>

<ul>
  <li>SMTP Host: <code class="highlighter-rouge">smtp.gmail.com</code></li>
  <li>SMTP Port: <code class="highlighter-rouge">587</code> or <code class="highlighter-rouge">465</code></li>
  <li>SMTP User: Your Gmail address (for example, example@gmail.com)</li>
  <li>SMTP Password: Your Gmail password</li>
  <li>SSL: use <code class="highlighter-rouge">SSL</code> for port <code class="highlighter-rouge">465</code> and <code class="highlighter-rouge">StartSSL</code> for port <code class="highlighter-rouge">587</code></li>
</ul>

<p>Then you need to define the e-mail address that is used for the <code class="highlighter-rouge">From</code>
field. This is in most cases the same address as used for the SMTP
User field.</p>

<p>The <code class="highlighter-rouge">Reply-To</code> field is optional and can be set to define a different
e-mail address that your recipients should use to answer a mail.</p>

<p>Once this is setup, you can start sending mails within docspell. It is
possible to set up these settings for multiple providers, so you can
choose from which account you want to send mails.</p>

<h2 id="imap-settings">IMAP Settings</h2>

<p>For receiving e-mails, you need to provide information to connect to
an IMAP server. Your e-mail provider should have this information
somewhere available.</p>

<p>Configure this in <em>User Settings -&gt; E-Mail Settings (IMAP)</em>:</p>

<div class="thumbnail">
  <img src="../img/mail-settings-2.png" />
</div>

<p>First you need to define a <em>Name</em> to recognize this connection inside
docspell. This name is also used in URLs to docspell and so it must
not contain whitespace or any special characters. A good value is the
domain of your provider, for example <code class="highlighter-rouge">gmail.com</code>, or something like
that.</p>

<p>You can provide imap connections to multiple mailboxes.</p>

<p>Here is an example for posteo.de:</p>

<ul>
  <li>IMAP Server: <code class="highlighter-rouge">posteo.de</code></li>
  <li>IMAP Port: 143</li>
  <li>IMAP User: Your posteo address</li>
  <li>IMAP Password: Your posteo password</li>
  <li>SSL: use <code class="highlighter-rouge">StartTLS</code></li>
</ul>

<h2 id="ssl--tls--starttls">SSL / TLS / StartTLS</h2>

<p><em>Please Note: If <code class="highlighter-rouge">SSL</code> is set to <code class="highlighter-rouge">None</code>, then mails will be sent
unencrypted to your mail provider! If <code class="highlighter-rouge">Ignore certificate check</code> is
enabled, connections to your mail provider will succeed even if the
provider is wrongly configured for SSL/TLS. This flag should only be
enabled if you know why.</em></p>

<h2 id="gmail">GMail</h2>

<p>Authenticating with GMail may be not so simple. GMail implements an
authentication scheme called <em>XOAUTH2</em> (at least for Imap). It will
not work with your normal password. This is to avoid giving an
application full access to your gmail account.</p>

<p>The e-mail integration in docspell relies on the
<a href="https://javaee.github.io/javamail">JavaMail</a> library which has
support for XOAUTH2. It also has documentation on what you need to do
on your gmail account: <a href="https://javaee.github.io/javamail/OAuth2">https://javaee.github.io/javamail/OAuth2</a>.</p>

<p>First you need to go to the <a href="https://console.developers.google.com">Google Developers
Console</a> and create an “App” to
get a Client-Id and a Client-Secret. This “App” will be your instance
of docspell. You tell google that this app may send and read your
mails and then you get an <em>access token</em> that should be used instead
of the password.</p>

<p>Once you setup an App in Google Developers Console, you get the
Client-Id and the Client-Secret, which look something like this:</p>

<ul>
  <li>Client-Id: 106701….d8c.apps.googleusercontent.com</li>
  <li>Client-Secret: 5Z1…Kir_t</li>
</ul>

<p>Google has a python tool to help with getting this access token.
Download the <code class="highlighter-rouge">oauth2.py</code> script from
<a href="https://github.com/google/gmail-oauth2-tools">here</a> and first create
an <em>oauth2-token</em>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./oauth2.py <span class="nt">--user</span><span class="o">=</span>your.name@gmail.com <span class="se">\</span>
   <span class="nt">--client_id</span><span class="o">=</span>106701....d8c.apps.googleusercontent.com <span class="se">\</span>
   <span class="nt">--client_secret</span><span class="o">=</span>5Z1...Kir_t <span class="se">\</span>
   <span class="nt">--generate_oauth2_token</span>
</code></pre></div></div>

<p>This will “redirect you” to an URL where you have to authenticate with
google. Afterwards it lets you add permissions to the app for
accessing your mail account. The result is another code you need to
give to the script to proceed:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4/zwE....q0QBAb-99yD7lw
</code></pre></div></div>

<p>Then the scripts produces this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Refresh Token: 1//09zH.........Lj6oc2SmFlZww
Access Token: ya29.a0........SECDQ
Access Token Expiration Seconds: 3599
</code></pre></div></div>

<p>The access token can be used to sign in via IMAP with google. The
Refresh Token doesn’t expire and can be used to generate new access
tokens:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./oauth2.py --user=your.name@gmail.com \
   --client_id=106701....d8c.apps.googleusercontent.com \
   --client_secret=5Z1...Kir_t \
   --refresh_token=1//09zH.........Lj6oc2SmFlZww
</code></pre></div></div>

<p>Output:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Access Token: ya29.a0....._q-lX3ypntk3ln0h9Yk
Access Token Expiration Seconds: 3599
</code></pre></div></div>

<p>The problem is that the access token expires. Docspell doesn’t support
updating the access token. It could be worked around by setting up a
cron-job or similiar which uses the <code class="highlighter-rouge">oauth2.py</code> tool to generate new
access tokens and update your imap settings via a <a href="../api">REST</a> call.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="c">## Change this to your values:</span>

<span class="nv">DOCSPELL_USER</span><span class="o">=</span><span class="s2">"[docspell-user]"</span>
<span class="nv">DOCSPELL_PASSWORD</span><span class="o">=</span><span class="s2">"[docspell-password]"</span>
<span class="nv">DOCSPELL_URL</span><span class="o">=</span><span class="s2">"http://localhost:7880"</span>
<span class="nv">DOCSPELL_IMAP_NAME</span><span class="o">=</span><span class="s2">"gmail.com"</span>

<span class="nv">GMAIL_USER</span><span class="o">=</span><span class="s2">"your.name@gmail.com"</span>
<span class="nv">CLIENT_ID</span><span class="o">=</span><span class="s2">"106701....d8c.apps.googleusercontent.com"</span>
<span class="nv">CLIENT_SECRET</span><span class="o">=</span><span class="s2">"secret=5Z1...Kir_t"</span>
<span class="nv">REFRESH_TOKEN</span><span class="o">=</span><span class="s2">"1//09zH.........Lj6oc2SmFlZww"</span>
<span class="c"># Path to the oauth2.py tool</span>
<span class="nv">OAUTH_TOOL</span><span class="o">=</span><span class="s2">"./oauth2.py"</span>

<span class="c">##############################################################################</span>
<span class="c">## Script</span>


<span class="c"># Login to docspell and store the auth-token</span>
<span class="nv">AUTH_DATA</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> <span class="nt">-XPOST</span> <span class="se">\</span>
                 <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
                 <span class="nt">--data-binary</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">account</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="nv">$DOCSPELL_USER</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">password</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="nv">$DOCSPELL_PASSWORD</span><span class="se">\"</span><span class="s2">}"</span> <span class="se">\</span>
                 <span class="nv">$DOCSPELL_URL</span>/api/v1/open/auth/login<span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="si">$(</span><span class="nb">echo</span> <span class="nv">$AUTH_DATA</span> | jq .success<span class="si">)</span> <span class="o">==</span> <span class="s2">"false"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Auth failed"</span>
    <span class="nb">echo</span> <span class="nv">$AUTH_DATA</span>
<span class="k">fi
</span><span class="nv">TOKEN</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$AUTH_DATA</span> | jq <span class="nt">-r</span> .token<span class="si">)</span><span class="s2">"</span>


<span class="c"># Get the imap settings</span>
<span class="nv">UPDATE_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DOCSPELL_URL</span><span class="s2">/api/v1/sec/email/settings/imap/</span><span class="nv">$DOCSPELL_IMAP_NAME</span><span class="s2">"</span>
<span class="nv">IMAP_DATA</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="nt">-H</span> <span class="s2">"X-Docspell-Auth: </span><span class="nv">$TOKEN</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$UPDATE_URL</span><span class="s2">"</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"Current Settings:"</span>
<span class="nb">echo</span> <span class="nv">$IMAP_DATA</span> | jq


<span class="c"># Get the new access token</span>
<span class="nv">ACCESS_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nv">$OAUTH_TOOL</span> <span class="nt">--user</span><span class="o">=</span><span class="nv">$GMAIL_USER</span> <span class="se">\</span>
    <span class="nt">--client_id</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CLIENT_ID</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--client_secret</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CLIENT_SECRET</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--refresh_token</span><span class="o">=</span><span class="s2">"</span><span class="nv">$REFRESH_TOKEN</span><span class="s2">"</span> | <span class="nb">head</span> <span class="nt">-n1</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">':'</span> <span class="nt">-f2</span> | xargs<span class="si">)</span>

<span class="c"># Update settings</span>
<span class="nb">echo</span> <span class="s2">"Updating IMAP settings"</span>
<span class="nv">NEW_IMAP</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$IMAP_DATA</span> | jq <span class="s2">".imapPassword |= </span><span class="se">\"</span><span class="nv">$ACCESS_TOKEN</span><span class="se">\"</span><span class="s2">"</span><span class="si">)</span>
curl <span class="nt">-s</span> <span class="nt">-XPUT</span> <span class="nt">-H</span> <span class="s2">"X-Docspell-Auth: </span><span class="nv">$TOKEN</span><span class="s2">"</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     <span class="nt">--data-binary</span> <span class="s2">"</span><span class="nv">$NEW_IMAP</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$UPDATE_URL</span><span class="s2">"</span>
<span class="nb">echo
echo</span> <span class="s2">"New Settings:"</span>
curl <span class="nt">-s</span> <span class="nt">-H</span> <span class="s2">"X-Docspell-Auth: </span><span class="nv">$TOKEN</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$UPDATE_URL</span><span class="s2">"</span> | jq
</code></pre></div></div>
</section><div class="edit-button"><a href="https://github.com/eikek/docspell/edit/master/modules/microsite/docs/doc/emailsettings.md" target="_blank" rel="noopener noreferrer" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','json','javascript']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/docs.js"></script></body></html>